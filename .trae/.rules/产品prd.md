## 漫画阅读软件产品需求文档 (PRD) 及开发计划
### 1. 产品概述
本产品是一款基于 flutter 技术栈开发的多台端漫画阅读软件，旨在为用户提供现代化、简约风格的漫画阅读体验。
软件将支持本地文件和常见远程网络文件协议，并具备强大的漫画库管理、书架功能和隐私保护模式。

### 2. 用户需求与功能列表
2.1 漫画库管理
- 漫画库概念 ：每个漫画库可对应一个不同的漫画来源如一个本地路径、网络路径等。
- 多漫画库管理 ：用户可创建、编辑、删除多个漫画库。
- 漫画库的扫描 ：可以扫描漫画库对应的路径。其中包含图片的文件夹，或者支持的压缩包作为一本漫画，如果文件夹内不包含图片，则向下查找
- 漫画信息识别 ：尝试自动识别漫画名称、作者、卷数等信息，或提供手动编辑功能。
- 漫画库下漫画封面展示模式设置：因为漫画首页可能为单独封面或者封面封底拼接扫描，所以需要指定库下漫画封面图片展示模式：默认，左半，右半。
- 漫画库的隐私模式 : 对于某些漫画库，用户可以设置为隐私模式，需要密码或指纹验证才能激活访问。但是对取消激活不需要认证。隐私模式的漫画每次重新进入软件时，需要重新输入密码或指纹验证才能访问。
  2.2 文件与协议支持
- 本地文件夹支持 ：可直接将包含图片的文件夹作为一本漫画
- 压缩包支持 ：支持 .zip , .rar , .7z , .cbz , .cbr , .cb7 等常见压缩格式
- PDF文件支持 ：支持将 .pdf 文件作为漫画进行阅读。
- 远程网络文件协议 ：支持 SMB/CIFS (Windows 共享)、FTP/SFTP、WebDAV、 NFS (Network File System) 等常见网络文件协议，允许用户直接访问远程服务器上的漫画资源。
- 远程漫画本地缓存 ：对于远程漫画，支持将其内容（或部分内容）缓存到本地，以提高阅读速度和离线阅读能力。
- 封面识别 ：对于文件夹或压缩包，自动识别其中的第一张图片作为漫画封面。
  2.3 书架功能
- 统一展示 ：书架可统一展示所有激活漫画库中的漫画。且拥有多种布局，漫画卡片上显示漫画封面。鼠标移动上去时显示中间的开始阅读按钮以及右上角的详情按钮。
- 筛选与过滤 ：支持基于漫画库、标签、分类、阅读状态等条件进行筛选和过滤。
- 系列组合 ：对于同一系列的漫画，支持在书架上进行组合显示，方便用户管理和查找。
- 排序功能 ：支持按名称、最近阅读、添加时间等多种方式排序。
  2.4 漫画详情页
- 漫画信息展示 ：包括顶部banner,中部基本信息:标题、阅读进度、总页数，作者、描述、评分、标签等,下部瀑布流式页面预览
- 页面预览 ：显示所有页面，并点击可跳转到对应页面开始阅读
- 收藏和分享 ：允许用户收藏漫画并分享到社交媒体。
- 阅读进度 ：显示当前阅读进度和总页数。
  2.5 核心阅读页
- 现代化与简约UI ：界面设计应遵循现代扁平化风格，操作直观，减少视觉干扰，提供沉浸式阅读体验。
- 底部进度条与预览条 ：底部显示当前阅读进度条，进度条上部显示预览条，方便用户快速定位和切换页面。
- 多种阅读模式 ：支持单页、双页阅读模式，并可根据用户习惯调整。
- 图片加载优化 ：优化大图加载速度，支持预加载，减少阅读卡顿。
- 阅读进度记忆 ：自动保存每本漫画的阅读进度，下次打开时可从上次阅读位置继续。
- 翻页/滚动控制 ：支持键盘、鼠标滚轮、触摸板等多种翻页/滚动方式。
- 全屏模式 ：支持全屏阅读模式，方便用户在大屏幕上阅读。全屏模式下，隐藏所有外部菜单，导航栏等。
  2.6 设置功能
- 外观设置 ：主题切换（深色/浅色）、字体大小等。
- 阅读器设置 ：阅读模式、阅读方向、图片适应模式、全屏模式等。
- 存储管理 ：漫画库管理、缓存清理等。
- 关于信息 ：应用版本、开发者信息、隐私政策等。
  2.7 补充需求
- 多语言支持 ：支持中文、英文等多种语言界面。
- 主题切换 ：提供浅色/深色主题切换功能。
- 快捷键支持 ：提供丰富的快捷键操作，提升用户效率。
- 错误处理与日志 ：完善的错误处理机制和日志记录，便于问题排查。
- 性能优化 ：确保软件在不同配置的设备上都能流畅运行，内存占用合理。
### 3. 技术栈选型
- 开发框架 ：Flutter (明确)   Dart(明确)
- 数据存储 ：适用嵌入式的SQLite数据库 (可考虑切换为性能更高的LMDB)
- 部分技术细节 ：
  - 图片加载 ：一个页面有多个图片时，使用懒加载+预加载的方式进行图片加载，减少内存占用。
  - 压缩文件的处理 ：流式读取文件，进行封面获取，和解压生成缩略图等
  - 漫画的延迟处理 ：扫描漫画库之后不进行漫画缩略图，解压等处理，而是延迟到用户第一次点击时再进行处理。此时进行分批处理，每处理完一批就保存到数据库，同时更新UI，避免阻塞UI线程。
  - 漫画库的扫描 ：使用多线程进行扫描，同时使用队列进行管理，避免阻塞UI线程。并且在前次扫描完成前，不能点击扫描，应该在扫描按钮上显示扫描中...等提示。
